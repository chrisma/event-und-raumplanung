<%- model_class = Event -%>
<% title @event.name %>

<div class="event-page-header">
  <div class="row event-section-divider">
    <div class="col-xs-12 col-md-8">
      <h1>
        <%= @event.name %>
        <% if current_user.id != @event.user_id %>
          <%= link_to show_toggle_favorite_from_event_path(@event), :remote => true, id: "btn_mark_as_favorite", 
                class: "event-favorite-icon " + (@favorite.empty? ? "event-favorite-icon-unchecked" : "event-favorite-icon-checked"), 
                data: { title_unmark: t('.unmark_as_favorite'), title_mark: t('.mark_as_favorite') } do %>
            <span class="glyphicon glyphicon-star" ></span>
          <% end %>
        <% end %>
      </h1>
    </div>
    <div class="col-xs-6 col-md-4" style="text-align: right">
      <h2><%= @event.starts_at.strftime("%d.%m.%Y") %></h2>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 col-md-8">
      <h3><%= @event.starts_at.strftime("%H:%M") %> Uhr - <%= @event.ends_at.strftime("%H:%M") %> Uhr</h3>
    </div>
    <div class="col-xs-6 col-md-4" style="text-align: right">
      <h3><%= concat_rooms(@event) %></h3>
    </div>
  </div>
</div>

<div class="row event-section-divider">
  <div class="col-xs-10 col-md-7 event-description">
    <%= raw nl2br h @event.description %>
  </div>
  <div class="col-xs-8 col-md-5">
    <table class="table table-striped">
      <tbody>
        <tr>
          <td><%= t('events.show.begin') %></td>
          <td><%= @event.starts_at.strftime("%d.%m.%Y - %H:%M") %></td>
        </tr>
        <tr>
          <td><%= t('events.show.end') %></td> 
          <td><%= @event.ends_at.strftime("%d.%m.%Y - %H:%M") %></td>
        </tr>
        <tr>
          <td><%= t('events.show.schedule') %></td>
          <td><%= @event.pretty_schedule %></td>
        </tr>
        <tr>
          <td><%= t('events.show.rooms') %></td>
          <td><%= concat_rooms(@event) %></td>
        </tr>
        <tr>
          <td><%= t('events.show.creator') %></td>
          <td><%= @user %></td>
        </tr>
        <tr>
          <td><%= t('events.show.participant_count') %></td>
          <td><%= @event.participant_count %></td>
        </tr>
        <tr>
          <td><%= t('events.show.status') %></td>
          <td><%= t 'event.status.'+@event.status %></td>
        </tr>
        <tr>
          <td>
            <%= render(partial: 'events/favorite', locals: { event: @event,  model_class:  model_class }) %>
          </td>
          <td>
            <% if (@event.is_approved) && (@event.exist_colliding_events) %>
              <%= link_to decline_event_path(@event), :title => t("helpers.links.decline"), :method => :decline, :class => 'btn btn-danger decline-btn btn-xs' do %>
                <span class="glyphicon glyphicon-remove"></span>
              <% end %>
            <%end%>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


<div class="event-view-section">
  <h3><%= t '.tasks' %></h3>
  <% @event_id = @event.id %>
  <%= render(partial: '/tasks/tasks_box', locals: { tasks: @tasks, event: @event })%> 
</div>

<% unless @feed_entries.nil? %>
<div class="event-view-section">
  <h3><%= t 'activities.activity_log' %></h3>

  <div class="feed-container">
    <div class="feed">
      <% @feed_entries.each_with_index do |feed_entry, index| %>
        <%= render :partial => 'feed_entry', :locals => { :feed_entry => feed_entry, :index => index } %>
      <% end %>
    </div>
  </div> 

  <div class="new-comment">
    <h4><%= t 'comments.new_comment' %></h4>

    <%= form_tag( { :action => "create_comment", :controller => "events", user_id: @current_user.id, event_id: @event.id}, { :method => :post }) do %>
      <%= text_area_tag "commentContent", "",  rows: 5, cols: 80, maxlength: 255 %>
      <div class="clearfix"></div>
      <button type="submit" class="btn btn-primary" title="<%= t('comments.new_comment') %>">
      <span class="glyphicon glyphicon-send"></span>
    </button>
    <% end %>  
  </div>
</div>
<% end %>

<div class="row">
  <div class="col-xs-4 col-md-3">
    <%= link_to :back, :title =>t("helpers.links.back"), :class => 'btn btn-default' do  %>
      <span class="glyphicon glyphicon-arrow-left"></span>    
    <% end %> 
  </div>
  <div class="col-xs-14 col-md-9 text-right">
    <%= link_to new_event_template_from_event_path(@event), :title => t("helpers.submit.create", :model => EventTemplate.model_name.human.titleize), :class => 'btn btn-default' do %>
      <span class="glyphicon glyphicon-list-alt"></span>    
    <% end %>
    <% if can? :edit, @event %>
      <%= link_to edit_event_path(@event), :title => t("helpers.links.edit"), :class => 'btn btn-default' do %>
        <span class="glyphicon glyphicon-pencil"></span>    
      <% end %>
    <% end %>

    <% if can? :destroy, @event %>
      <%= link_to event_path(@event),
                    :title => t("helpers.links.destroy"),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn btn-danger' do %>
        <span class="glyphicon glyphicon-trash"></span>    
      <% end %>            
    <% end %>
  </div>
</div>
