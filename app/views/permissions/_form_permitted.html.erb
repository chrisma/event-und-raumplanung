<%= form_tag({action: 'submit'}, {remote: true, :'data-type' => 'json', id: "permissionsForm", :class => "form-horizontal"}) do |f| %>
  <div class="control-group">
    <div class="controls">
      <%= hidden_field_tag 'type', 'entity' %>
      <%= select_tag 'user',
        grouped_options_for_select([
            [User.model_name.human.pluralize.titleize, @users.map {|x| [x.username, "User:#{x.id}"]}],
            [Group.model_name.human.pluralize.titleize, @groups.map {|x| [x.name, "Group:#{x.id}"]}]
          ]), {class: 'selectpicker', id: 'user', :'data-live-search' => "true"}%>
      
      <div id="permissionDiv"></div>

      <script>
        $(function() {
          $('#user').ready(updateUserPermissions);
          $(document).on('ajax:success', '#permissionsForm', function(event, data) {
            $('#flash_messages').bootstrap_flash(data);
          });
        })
      </script>

      <%= submit_tag nil, :class => 'btn btn-primary' %>
      <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
              permissions_path, :class => 'btn btn-default' %>

    </div>
  </div>
  <br></br>
  

<% end %>